
{% extends "pages/layout.html" %} {% block title %} Thông tin khách hàng {% endblock %} 
{% block content %} 
{% load static %}

<section style="background-color: #eee;">
    <div class="container py-5">    
        <div class="row">
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-body text-center">
                        <img src="{% static 'img/hinhDaiDien.jpg' %}" alt="avatar" class="rounded-circle img-fluid" style="width: 150px;">
                        <h5 class="my-3">{{ DSThongTinKH.0.0 }}</h5>
                        <div class="d-flex justify-content-center mb-2">
                            <button type="button" class="btn btn-sm btn-primary float-end" data-bs-toggle="modal" data-bs-target="#ModalSuaTTTK" data-bs-whatever="@fat"
                            data-email="{{ DSThongTinKH.0.1}}" data-username="{{ DSThongTinKH.0.5}}">Sửa tài khoản</button>    <div><pre> </pre></div>                     
                            <a class="btn btn-outline-primary" href="/lichSuMuaHang">Xem lịch sử mua hàng</a>
                        </div>
                    </div>
                </div>
                <div class="card mb-4 mb-lg-0">
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush rounded-3">
                            <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                                <div class="row w-100">
                                    <div class="col-1">
                                        <i class="fa-solid fa-envelope"></i>          
                                    </div>                                    
                                    <div class="col-3">
                                        <span>Email:</span>           
                                    </div>
                                    <div class="col-8">
                                        <p class="text-muted mb-0"> {{ DSThongTinKH.0.1}}</p>
                                    </div>
                                </div>                                                  
                                
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                                <div class="row w-100">
                                    <div class="col-sm-1">
                                        <i class="fa-solid fa-lock" style="color: #ac2bac;"></i>         
                                    </div>                                    
                                    <div class="col-sm-5">
                                        <span>Tài khoản:</span>           
                                    </div>
                                    <div class="col-sm-6">
                                        <p class="text-muted mb-0"> {{ DSThongTinKH.0.5}}</p>
                                    </div>
                                </div>                                 
                                
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                                <div class="row w-100">
                                    <div class="col-sm-1">
                                        <i class="fa-solid fa-lock" style="color: #3b5998;"></i>        
                                    </div>                                    
                                    <div class="col-sm-5">
                                        <span>Mật khẩu:</span>           
                                    </div>
                                    <div class="col-sm-6">
                                        <p class="text-muted mb-0"> ******</p>
                                    </div>
                                </div>   
                                                               
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                {% if DSThongTinKH is null %}
                <div class="card mb-4">
                    <div class="card-body">
                        <p class="mb-4"><span class="text-primary font-italic me-1"></span> <b>Thông tin cá nhân</b>
                        <button type="button" class="btn btn-sm float-end" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@fat"
                        data-name="{{ thongTinKH.0 }}" data-email="{{ thongTinKH.1 }}" data-phone="{{ thongTinKH.2 }}" data-address="{{ thongTinKH.3 }}" data-number="{{ thongTinKH.4 }}"><i class="fa-solid fa-pen"></i></button>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Họ tên: </p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0"> Chưa có</p>
                            </div>
                        </div>
                        
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Số điện thoại: </p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0">Chưa có</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Địa chỉ: </p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0">Chưa có</p>
                            </div>
                        </div>
                        <!-- <input type="text" class="form-control" id="Makh" name="MaKH" value="{{ ThongTinKH.5 }}" hidden>  -->
                    </div>
                </div> 
                {% else %}   
                <div class="card mb-4">
                    <div class="card-body">
                        <span class="mb-4"><span class="text-primary font-italic me-1"></span> <b>Thông tin nhận hàng</b> 
                        <a href="/themThongTinKH/" class="btn btn-sm float-end" data-bs-toggle="modal" data-bs-target="#modelThemTT"><i class="fa-solid fa-plus"></i></a>                        
                    </div> 
                </div> 

                {% for thongTinKH in DSThongTinKH %}             
                <div class="card mb-4">                       
                    <div class="card-body">
                        <!-- <p class="mb-4"><span class="text-primary font-italic me-1"></span> <b>Thông tin cá nhân</b> -->
                        <button type="button" class="btn btn-sm float-end" data-bs-toggle="modal" data-bs-target="#ModalXoaTT" data-bs-whatever="@fat"
                        data-name="{{ thongTinKH.0 }}" data-phone="{{ thongTinKH.2 }}" data-address="{{ thongTinKH.3 }}" data-number="{{ thongTinKH.4 }}"><i class="fa-solid fa-trash"></i></button>
                                
                        <button type="button" class="btn btn-sm float-end" data-bs-toggle="modal" data-bs-target="#ModalSuaTT" data-bs-whatever="@fat"
                        data-name="{{ thongTinKH.0 }}" data-phone="{{ thongTinKH.2 }}" data-address="{{ thongTinKH.3 }}" data-number="{{ thongTinKH.4 }}"><i class="fa-solid fa-pen"></i></button>
                                           
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Họ tên: </p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0"> {{thongTinKH.0}}</p>
                            </div>
                        </div>               
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Số điện thoại: </p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0">{{thongTinKH.2}}</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Địa chỉ: </p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0">{{thongTinKH.3}}</p>
                            </div>
                        </div>
                        <input type="text" class="form-control" id="Makh" name="MaKH" value="{{ ThongTinKH.4 }}" hidden> <!--ẨN ĐI-->
                        
                    </div>    
                               
                </div> 
                {% endfor %}     
                {% endif %}              
               
                              
                
            </div>
        </div>
</section>


<!-- Modal THÊM THÔNG TIN KHÁCH HÀNG -->
<div class="modal fade" id="modelThemTT" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered  d-flex justify-content-center">
        <div class="modal-content w-100">
            <div class="modal-body p-4">
                <!-- <img src="{% static 'img/hinhDaiDien.jpg' %}" alt="avatar" class="rounded-circle position-absolute top-0 start-50 translate-middle h-50" /> -->
                <form method="post" action="/themThongTinKH/" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div>
                        <h5 class="pt-5 text-center my-3">Thêm thông tin nhận hàng</h5>
                        <div class="mb-3">
                            <label for="Hoten" class="col-form-label">Họ tên:</label>
                            <input type="text" class="form-control" id="Hoten" name="HoTen">
                        </div>                       
                        <div class="mb-3">
                            <label for="Sodienthoai" class="col-form-label">Số điện thoại:</label>
                            <input type="text" class="form-control" id="Sodienthoai" name="SDT">
                        </div>    
                        <div class="mb-3">
                            <label for="Diachi" class="col-form-label">Địa chỉ:</label>
                            <input type="text" class="form-control" id="Diachi" name="DiaChi">
                        </div>                    
                    
                        <!-- Submit button -->
                        <div class="d-flex justify-content-center align-items-center">
                            <button type="submit" data-mdb-button-init data-mdb-ripple-init class="btn" style="background-color: pink;">Lưu</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- Modal CẬP NHẬT THÔNG TIN KHÁCH HÀNG -->
<div class="modal fade" id="ModalSuaTT" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered  d-flex justify-content-center">
        <div class="modal-content w-100">
            <div class="modal-body p-4">
                <!-- <img src="{% static 'img/hinhDaiDien.jpg' %}" alt="avatar" class="rounded-circle position-absolute top-0 start-50 translate-middle h-50" /> -->
                <form method="post" action="/capNhatThongTinKH/" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div>
                        <h5 class="pt-5 text-center my-3">Cập nhật thông tin</h5>
                        <input type="text" class="form-control" id="Makh" name="MaKH" value="{{ ThongTinKH.4 }}" hidden> <!--ẨN ĐI-->
                        <div class="mb-3">
                            <label for="Hoten" class="col-form-label">Họ tên:</label>
                            <input type="text" class="form-control" id="Hoten" name="HoTen" value="{{ ThongTinKH.0 }}">
                        </div>                       
                        <div class="mb-3">
                            <label for="Sodienthoai" class="col-form-label">Số điện thoại:</label>
                            <input type="text" class="form-control" id="Sodienthoai" name="SDT" value="{{ThongTinKH.2}}">
                        </div>    
                        <div class="mb-3">
                            <label for="Diachi" class="col-form-label">Địa chỉ:</label>
                            <input type="text" class="form-control" id="Diachi" name="DiaChi" value="{{ThongTinKH.3}}">
                        </div>                    
                    
                        <!-- Submit button -->
                        <div class="d-flex justify-content-center align-items-center">
                            <button type="submit" data-mdb-button-init data-mdb-ripple-init class="btn" style="background-color: pink;">Lưu</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


  
<!-- Modal XÓA THÔNG TIN KHÁCH HÀNG -->
  <div class="modal fade" id="ModalXoaTT" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Xóa thông tin nhận hàng</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="post" action="/xoaThongTinKH/" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="text" class="form-control" id="Makh" name="MaKH" value="{{ ThongTinKH.4 }}" hidden> <!--ẨN ĐI-->           
            <div class="modal-body">
            Bạn có chắc muốn xóa thông tin này không?
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            <button type="submit" class="btn" style="background-color: pink;">Xóa</button>
            </div>
        </form>
      </div>
    </div>
  </div>



<!-- Modal CẬP NHẬT TÀI KHOẢN -->
<div class="modal fade" id="ModalSuaTTTK" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered d-flex justify-content-center">
        <div class="modal-content w-100">
            <div class="modal-body p-4">
                <form id="updateAccountForm" method="post" action="/capNhatTaiKhoan/">
                    {% csrf_token %}
                    <h5 class="pt-5 text-center my-3">Cập nhật tài khoản</h5>

                    <div class="mb-3">
                        <label for="Username" class="col-form-label">Tên tài khoản:</label>
                        <input type="text" class="form-control" id="Username" name="Username" readonly value="{{ ThongTinKH.5 }}">
                    </div> 

                    <div class="mb-3">
                        <label for="Email" class="col-form-label">Email:</label>
                        <input type="email" class="form-control" id="Email" name="Email" value="{{ ThongTinKH.1 }}">
                    </div>                   

                    <div class="mb-3">
                        <label for="Passcu" class="col-form-label">Mật khẩu cũ:</label>
                        <input type="password" class="form-control" id="Passcu" name="Passcu">
                    </div> 

                    <div class="mb-3">
                        <label for="Passmoi" class="col-form-label">Mật khẩu mới:</label>
                        <input type="password" class="form-control" id="Passmoi" name="Passmoi">
                    </div>                      

                    <div class="d-flex justify-content-center align-items-center">
                        <button type="button" id="btnUpdate" class="btn" style="background-color: pink;">Cập nhật</button>
                    </div>

                    <div id="updateMessage" class="mt-3"></div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    document.getElementById('btnUpdate').addEventListener('click', function () {
        const form = document.getElementById('updateAccountForm');
        const formData = new FormData(form);
    
        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        })
        .then(response => response.json())
        .then(data => {
            const messageDiv = document.getElementById('updateMessage');
            if (data.success) {
                messageDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
            } else {
                messageDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
            }
        })
        .catch(error => {
            console.error('Lỗi:', error);
            document.getElementById('updateMessage').innerHTML = 
                `<div class="alert alert-danger">Đã xảy ra lỗi trong quá trình cập nhật.</div>`;
        });
    });
</script>


<!-- <script src="{% static 'bootstrap_admin/vendor/jquery/jquery.min.js'%}"></script> -->



<!--Lấy dữ liệu đưa vào model sửa-->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const exampleModal = document.getElementById('ModalSuaTT');

    // Lắng nghe sự kiện trước khi modal được hiển thị
    exampleModal.addEventListener('show.bs.modal', function (event) {
        // Lấy button đã kích hoạt modal
        const button = event.relatedTarget;

        // Lấy dữ liệu từ button
        const name = button.getAttribute('data-name');
       // const email = button.getAttribute('data-email');
        const phone = button.getAttribute('data-phone');
        const address = button.getAttribute('data-address'); 
        const number = button.getAttribute('data-number'); 
        // const defaltut = button.getAttribute('data-defaltut'); 

        // Gán dữ liệu vào các trường input của modal
        const modalNameInput = exampleModal.querySelector('#Hoten');
        //const modalEmailInput = exampleModal.querySelector('#Email');
        const modalPhoneInput = exampleModal.querySelector('#Sodienthoai');
        const modalAddressInput = exampleModal.querySelector('#Diachi');
        const modalNumberInput = exampleModal.querySelector('#Makh');
        // const modalDefaltutInput = exampleModal.querySelector('#Macdinh');

        modalNameInput.value = name || '';
       // modalEmailInput.value = email || '';
        modalPhoneInput.value = phone || '';
        modalAddressInput.value = address || '';
        modalNumberInput.value = number || '';
        // modalDefaltutInput.value = defaltut || '';
    });
});

</script>



<!--Lấy dữ liệu đưa vào model xóa-->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const exampleModal = document.getElementById('ModalXoaTT');
    
        // Lắng nghe sự kiện trước khi modal được hiển thị
        exampleModal.addEventListener('show.bs.modal', function (event) {
            // Lấy button đã kích hoạt modal
            const button = event.relatedTarget;
    
            // Lấy dữ liệu từ button
            const number = button.getAttribute('data-number'); 
    
            // Gán dữ liệu vào các trường input của modal
            const modalNumberInput = exampleModal.querySelector('#Makh');
    
            modalNumberInput.value = number || '';
        });
    });
    
    </script>




<!--Lấy dữ liệu đưa vào model sửa tài khoản-->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const exampleModal = document.getElementById('ModalSuaTTTK');
    
        // Lắng nghe sự kiện trước khi modal được hiển thị
        exampleModal.addEventListener('show.bs.modal', function (event) {
            // Lấy button đã kích hoạt modal
            const button = event.relatedTarget;
    
            // Lấy dữ liệu từ button
            const email = button.getAttribute('data-email');
            const number = button.getAttribute('data-username'); 
    
            // Gán dữ liệu vào các trường input của modal
            const modalEmailInput = exampleModal.querySelector('#Email');
            const modalNumberInput = exampleModal.querySelector('#Username');
    
            modalEmailInput.value = email || '';
            modalNumberInput.value = number || '';
        });
    });
    
    </script>
{% endblock %}