{% extends "pages/layout.html" %}
{% block title %}
    S·∫£n ph·∫©m
{% endblock %}

{% block content %}
{% load static %}


<div id="main">
    <div id="content">
        <div class="grid">
            <div class="grid__row">
                <!--THANH BAR B√äN TR√ÅI-->
                <div class="grid_column-2">
                    <div class="aside-filter">
                        <div class="headding-filter">
                            <h2 class="title-head">B·ªô l·ªçc</h2>
                            <p>Gi√∫p b·∫°n t√¨m ki·∫øm s·∫£n ph·∫©m nhanh h∆°n</p>
                        </div>
                        <hr>
                        <div class="filter">
                            <h3>Th∆∞∆°ng hi·ªáu</h3>
                            <div class="search-filter">
                                <input type="text" placeholder="T√¨m th∆∞∆°ng hi·ªáu">
                                <a class="bg-icon-search" href=""><i class="ti-search "></i></a>
                            </div>
                            <div class="filter-brand">
                                <ul class="filter-option">
                                    <li class="filter-item">
                                        <input type="checkbox"><span>3CE</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="checkbox"><span>AFC</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="checkbox"><span>AGAPAN</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="checkbox"><span>3W Clinic</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="checkbox"><span>A-DERMA</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="checkbox"><span>Vichy</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="checkbox"><span>Victoria's</span>
                                    </li>
                                </ul>
                            </div>

                            <h3>Gi√° s·∫£n ph·∫©m</h3>
                            <form method="get" id="filter-form">
                                <ul class="filter-option">
                                    <li class="filter-item">
                                        <input type="radio" name="gia_khoang" value="duoi_100"
                                            {% if 'duoi_100' in gia_khoang %}checked{% endif %}
                                            onchange="this.form.submit();">
                                        <span>Gi√° d∆∞·ªõi 100.000ƒë</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="radio" name="gia_khoang" value="100_200"
                                            {% if '100_200' in gia_khoang %}checked{% endif %}
                                            onchange="this.form.submit();">
                                        <span>100.000ƒë - 200.000ƒë</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="radio" name="gia_khoang" value="200_300"
                                            {% if '200_300' in gia_khoang %}checked{% endif %}
                                            onchange="this.form.submit();">
                                        <span>200.000ƒë - 300.000ƒë</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="radio" name="gia_khoang" value="300_500"
                                            {% if '300_500' in gia_khoang %}checked{% endif %}
                                            onchange="this.form.submit();">
                                        <span>300.000ƒë - 500.000ƒë</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="radio" name="gia_khoang" value="500_1000"
                                            {% if '500_1000' in gia_khoang %}checked{% endif %}
                                            onchange="this.form.submit();">
                                        <span>500.000ƒë - 1.000.000ƒë</span>
                                    </li>
                                    <li class="filter-item">
                                        <input type="radio" name="gia_khoang" value="tren_1000"
                                            {% if 'tren_1000' in gia_khoang %}checked{% endif %}
                                            onchange="this.form.submit();">
                                        <span>Tr√™n 1.000.000ƒë</span>
                                    </li>
                                </ul>
                            </form>
                        </div>

                    </div>
                </div>

                <!--DANH S√ÅCH SP LOAD L√äN T·ª™ DATABASE-->
                <div class="grid_colum-10">
                    <div class="grid__row">

                        <div class="home-filter-headding" style="height:60px;width:100%">
                            <h1 class="home-title-product">
                                Danh S√°ch SaÃân Ph√¢Ãâm
                            </h1>
                            <div class="home-filter">
                                <ul class="list-filter">
                                    <li>
                                        <a style="color:blue;" href="#" onclick="updateSorting('tang_dan'); return false;">ü°Ö Gi√° tƒÉng d·∫ßn</a>
                                    </li>
                                    <li>
                                        <a style="color:red;" href="#" onclick="updateSorting('giam_dan'); return false;">ü°á Gi√° gi·∫£m d·∫ßn</a>
                                    </li>
                                </ul>
                            </div> 
                        </div>

                        {% for product in san_phams %}
                        <div class="grid_column-2-4">
                            <div class="home-product-item">
                                <div class="product-img">
                                    <a href="/shop_detail/{{ product.0 }}">
                                        <img src="{% static 'img/' %}{{ product.2 }}" alt="{{ product.1 }}" style="width: 220px; height: 220px;">
                                    </a>
                                </div>
                                <h4 class="product-item-name">
                                    <a href="{% url 'shop_detail' product.0 %}">{{ product.1 }}</a>
                                </h4>
                                <div class="product-item-price">
                                    <span class="price-current">{{ product.3|floatformat:0 }} </span>
                                    <span class="vnd">‚Ç´</span>
                                </div>
                                <div class="product-item-action">
                                    <span class="product-item-action-like product-item-action-like-liked">
                                        <i class="product-item-action-like-empty ti-heart"></i>
                                        <i class="product-item-action-like-fill fa-solid fa-heart"></i>
                                    </span>
                                    <div class="product-item-action-rating">
                                        <i class="product-item-action-star-gold fa-solid fa-star"></i>
                                        <i class="product-item-action-star-gold fa-solid fa-star"></i>
                                        <i class="product-item-action-star-gold fa-solid fa-star"></i>
                                        <i class="product-item-action-star-gold fa-solid fa-star"></i>
                                        <i class="product-item-action-star-gold fa-solid fa-star"></i>
                                    </div>
                                </div>
                                <a class="product-item-btn-addcart" href="/addCart/?action=addcart&id_product={{ product.0 }}">Th√™m v√†o gi·ªè h√†ng</a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <!-- PH√ÇN TRANG -->
        <div class="container">
            <div class="row">
                <div class="col d-flex justify-content-center">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            <!-- N√∫t "Previous" -->
                            <li class="page-item {% if san_phams.number <= 1 %} disabled {% endif %}">
                                <a class="page-link" href="/shop?page={{ previous_page }}" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>

                            <!-- Hi·ªÉn th·ªã c√°c n√∫t s·ªë trang -->
                            {% for i in page_range %}
                                <li class="page-item {% if i == san_phams.number %}active{% endif %}">
                                    <a class="page-link" href="/shop?page={{ i }}">{{ i }}</a>
                                </li>
                            {% endfor %}

                            <!-- N√∫t "Next" -->
                            <li class="page-item {% if san_phams.number >= total_pages %} disabled {% endif %}">
                                <a class="page-link" href="/shop?page={{ next_page }}" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>

                        </ul>
                    </nav>
                </div>
            </div>
        </div> 
        
    </div>

</div>

<script>
    function updateFilters(checkbox) {
        // L·∫•y URL hi·ªán t·∫°i
        const url = new URL(window.location.href);

        // L·∫•y danh s√°ch gi√° tr·ªã "gia_khoang" hi·ªán t·∫°i t·ª´ URL
        const params = url.searchParams;
        const selectedValues = params.getAll('gia_khoang');

        // Ki·ªÉm tra tr·∫°ng th√°i checkbox
        if (checkbox.checked) {
            // Th√™m gi√° tr·ªã n·∫øu ch∆∞a c√≥
            if (!selectedValues.includes(checkbox.value)) {
                params.append('gia_khoang', checkbox.value);
            }
        } else {
            // X√≥a gi√° tr·ªã n·∫øu checkbox b·ªã b·ªè ch·ªçn
            params.delete('gia_khoang'); // X√≥a t·∫•t c·∫£ tr∆∞·ªõc
            selectedValues.forEach(value => {
                if (value !== checkbox.value) {
                    params.append('gia_khoang', value);
                }
            });
        }

        // C·∫≠p nh·∫≠t URL v√† t·∫£i l·∫°i trang
        window.location.href = url.toString();
    }

    function updateSorting(order) {
        const url = new URL(window.location.href);
        const params = url.searchParams;

        // X√≥a tham s·ªë `sap_xep` c≈© n·∫øu t·ªìn t·∫°i
        params.delete('sap_xep');

        // Th√™m tham s·ªë `sap_xep` m·ªõi
        params.append('sap_xep', order);

        // C·∫≠p nh·∫≠t URL
        window.location.href = url.toString();
    }
</script>

{% endblock %}